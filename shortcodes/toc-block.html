<div class="toc-section">
  <div class="toc-content">
    <div class="toc-header" onclick="toggleTOC(this)">
      <h4>
        <span class="toggle-icon">▼</span>
        本文目錄
      </h4>
    </div>
    <div class="toc-body">
      {{ $toc := .Page.TableOfContents }}
      {{ $toc := replaceRE `<nav id="TableOfContents">` `<nav id="TableOfContents" data-depth="4">` $toc }}
      {{ $toc | safeHTML }}
    </div>
  </div>
</div>

<style>
.toc-section {
  padding: 0.375rem;
  border-radius: 8px;
  margin: 0.25rem 0;
  border: 1px solid currentColor;
  color: var(--bs-body-color);
}

.toc-header {
  cursor: pointer;
  user-select: none;
}

.toc-header h4 {
  margin-top: 0;
  color: #b4913c;
  margin-bottom: 0.25rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 1.1rem;
}

.toggle-icon {
  font-size: 0.8em;
  transition: transform 0.2s ease;
}

.toc-header.collapsed .toggle-icon {
  transform: rotate(-90deg);
}

.toc-body {
  transition: max-height 0.3s ease-out;
  overflow: hidden;
  max-height: 1000px;
}

.toc-header.collapsed + .toc-body {
  max-height: 0;
}

/* TOC 樣式 */
.toc-section nav#TableOfContents {
  font-size: 0.9rem;
}

.toc-section nav#TableOfContents ul {
  list-style: disc;
  padding-left: 1rem;
}

.toc-section nav#TableOfContents > ul > li {
  margin-bottom: 0.125rem;
}

/* 次層級縮排 */
.toc-section nav#TableOfContents ul ul {
  padding-left: 1rem;
  margin-top: 0.075rem;
}

/* 連結樣式 */
.toc-section nav#TableOfContents a {
  color: inherit;
  text-decoration: underline;
  display: inline-block;
  padding: 0.05rem 0;
  transition: all 0.2s ease;
}

.toc-section nav#TableOfContents a:hover,
.toc-section nav#TableOfContents li a:hover {
  color: #b4913c !important;
  text-decoration: none !important;
  opacity: 0.85;
}
</style>

<script>
function toggleTOC(header) {
  header.classList.toggle('collapsed');
}
</script> 